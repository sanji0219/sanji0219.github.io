<!DOCTYPE html>
<html>

<head>
    <title>Chat Sample</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase.js"></script>

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <link rel="stylesheet" href="style.css">

    <script>
        // Your web app's Firebase configuration
        var Config = {
        apiKey: "AIzaSyCuweAmnX3D20XMzxQnQw6keEajy5NP4wY",
        authDomain: "testest-686fd.firebaseapp.com",
        databaseURL: "https://testest-686fd-default-rtdb.firebaseio.com",
        projectId: "testest-686fd",
        storageBucket: "testest-686fd.appspot.com",
        messagingSenderId: "793998805037",
        appId: "1:793998805037:web:cc8bfc0d00795d0e5850a4",
        measurementId: "G-54SH47HBKH"
        };
        // Initialize Firebase
        firebase.initializeApp(Config);
    </script>
</head>



<body>
    <img src="IMG_0564.jpg" alt="">
    <p class="explain">気温と湿度の入力でグラフ化することができます。もし、それに加えてコメントがあるなら記入すると下に表示されます。必ずしも、コメントを記入しないといけないわけではありません。</p>
    <div id="chart"></div>
    <div>
        <div>
            <input class="txtbox" type="text" id="temperature" placeholder="気温(半角数字で)">
        </div>
        <div>
            <input class="txtbox" type="text" id="humidity" placeholder="湿度(半角数字で)">
        </div>
        <div>
            <textarea class="txtbox" id="comment" rows="3" placeholder="コメントがあれば記入をしてください"></textarea>
        </div>
        <div>
            <button id="posts">投稿する</button>
        </div>
    </div>

    <div id="posts_list"></div>

</body>

</html>

<script>
    const database = firebase.database();
    const ref = database.ref("posts");
    const arrays=[];
    const lists=[];

    // 登録処理
    const postAction = () => {
        const temperature = $("#temperature").val();
        const humidity = $("#humidity").val();
        const comment=$("#comment").val();

        if (temperature && temperature !== "" && humidity && humidity !== "") {
            if (new Date().getMonth()+1>12){
                var month=1;
            }else{
                var month=new Date().getMonth()+1
            }
            ref.push({
                temperature: temperature,
                humidity: humidity,
                comment:comment,
                date: String(month)+"月"+String(new Date().getDate())+"日"
            });
        }
        // とりあえず登録終わったら空にしとく
        $("#temperature").val("");
        $("#humidity").val("");
        $("#comment").val("");
    };

    // 登録時のアクション
    $('#posts').click(() => postAction());

    // 初期表示と登録後のコールバック
    ref.on("child_added", (snapshot) => {
        dispContents({
            id: snapshot.key,
            value: snapshot.val()
        });
    });


    //TODOを表示する
    const dispContents = (content) => {
        //リストの一番上に挿入
        var Hiduke=String(content.value.date)
        var Ondo=Number(content.value.temperature);
        var Sitsudo=Number(content.value.humidity);
        var Komento=String(content.value.comment)
        var array=[Hiduke,Ondo,Sitsudo]
        arrays.push(array)
        function makeComments(){
            if(Komento!==""){
                var list=[Hiduke,Komento]
            }
            $("#posts_list").prepend(`<div class="comments"><p>${list[0]}<br><span>${list[1]}</span></p></div>`);
        }
        makeComments();

        google.load('visualization', '1', { packages : [ 'corechart' ]});
        google.setOnLoadCallback(drawChart);

    function drawChart(){
         // 表示するデータの設定
        var data = new google.visualization.DataTable();
        data.addColumn('string', '日');
        data.addColumn('number', '気温');
         //水位に変更
        data.addColumn('number', '湿度');
        //気温に変更
        // data.addColumn('number', '降水量');
        //降水量に変更
    
        data.addRows(arrays);

        // グラフの設定
        var option = {
            title: '温度と湿度の推移データ',
            width: '100%',
            height:'100%',
    
            series: [
                { type: 'line', targetAxisIndex: 0 },
                { type: 'bars', targetAxisIndex: 1 },
            ],
            vAxes: [
                { title: '温度(°C)' },
                //水位に変更
                { title: '湿度(％)' },
                //気温に変更
                //降水量に変更
            ]
        };
    
        var chart = new google.visualization.ComboChart(document.getElementById('chart'));
        chart.draw(data, option);
    }

    }

    
</script>

